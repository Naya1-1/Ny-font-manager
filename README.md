# Ny-font-manager 字体管理器
本插件奈亚（xn1060）完成，其中外部聊天字体导入模块感谢lim的灵感与制作。**Ny字体管理器** 是一个为 SillyTavern (酒馆) 设计的高级字体管理与打字机特效增强插件。它不仅允许你自定义聊天界面的正文和对话字体，还支持强大的**多语言字体混排**功能（为中文、日文、英文等不同语言指定不同字体），并内置了**Web 字体导入**和**本地字体上传**功能。此外，它还能修复部分角色卡片或正则脚本中引入的外部字体无法加载的问题。

## ✨ 主要功能

### 1. 细致的字体控制
*   **全局字体**：修改整个 SillyTavern 的界面字体（覆盖顺序低于「正文 / 对话」字体）。
*   **正文字体**：一键修改所有聊天消息的默认字体（会覆盖全局字体）。
*   **独立对话字体**：自动识别引号（`“` `”` `"` 等）内的对话内容，并为其应用独立的字体，让对话与旁白区分开来。
*   **自定义包裹样式**：支持自定义包裹符号（例如 `『` 和 `』`），被包裹的内容将应用特定字体（适合旁白、系统提示或心理活动）。

### 2. 🌐 多语言字体混排 (Locale Fonts)
这是本插件最强大的功能之一。你可以为同一条消息中的不同语言脚本指定不同的字体：
*   例如：汉字使用「思源宋体」，英文使用「Times New Roman」，日文假名使用「Meiryo」。
*   支持的范围包括：汉字 (CJK)、日文假名、韩文、英文/拉丁文、希腊文、西里尔文、数字、标点符号、Emoji 等。
*   完美解决中西文混排时的字体显示不协调问题。

### 3. 字体导入与管理
*   **Web 字体导入**：支持直接粘贴 CSS 链接（如 Google Fonts）导入在线字体。
*   **本地字体上传**：支持上传 `.ttf`, `.otf`, `.woff`, `.woff2` 字体文件。
    *   文件存储在浏览器本地数据库 (IndexedDB) 中，不会增加服务器负担，且加载速度快。
*   **可视化管理**：在设置面板中查看、预览、删除已导入的字体，或将其快速应用为全局/正文/对话/自定义字体。

### 4. 🛠️ 聊天样式增强与修复
*   **外部字体自动修复**：开启「聊天外部字体导入」后，插件会自动扫描消息内容和正则脚本，强制加载其中引用的 `@import` 或 `<style>` 字体链接。这解决了 SillyTavern 可能会过滤掉样式导致部分高级角色卡字体失效的问题。

### 5. ✨ 流式渲染与动画特效
*   **多种特效**：除了经典的打字机效果，还提供「模糊显现」和「流光浮现」等现代动画，让回复过程更具沉浸感。
*   **实时流式渲染**：接管 SillyTavern 的消息渲染，实现字符级的动画控制。
*   **高度客制化**：可调节打字速度（毫秒/字）、启用/禁用打字机光标等。

## 📦 安装方法

1. 打开 SillyTavern 的 **Extensions (扩展)** 菜单。
2. 点击 **Install Extension (安装扩展)**。
3. 在 URL 栏输入本仓库地址（或将本插件文件夹放入 `public/scripts/extensions/third-party/` 目录下）。
4. 安装完成后刷新页面。

## ⚙️ 使用说明

插件设置位于扩展栏的 **Ny Typewriter / Fonts** 面板中。

### 字体设置 (Settings)
*   **启用字体覆盖**：总开关。
*   **全局字体**：影响整个 SillyTavern。
*   **正文字体**：点击输入框右侧的气泡选择已导入的字体或系统字体。
*   **对话字体**：设置引号内文本的字体。
*   **按语言设置字体**：
    1. 勾选启用。
    2. 点击「添加语言规则」。
    3. 选择目标语言（如 CJK 汉字）和对应的字体。
    4. 调整规则顺序以处理优先级。
*   **自定义包裹字符**：
    1. 设置起始符号（如 `(`）和结束符号（如 `)`）。
    2. 选择对应的字体。

### 显示设置 (Display)
*   **渲染模式**：
    *   **默认缓冲 (Buffer)**：SillyTavern 原生行为，一次性显示整段文本。
    *   **实时显示 (Stream)**：启用流式渲染，字符逐个输出，是启用动画特效的前提。
*   **动画特效**：
    *   在「关闭」、「打字机」、「模糊显现」、「流光浮现」之间切换。
    *   提供可视化预览窗口，点击箭头即可切换效果。
*   **参数调整**：
    *   **速度**：拖动滑块调整打字机的输出速度（ms/字）。
    *   **光标**：开关打字机末尾的闪烁光标。
*   **字号 / 字间距**：可按正文/对话/自定义/多语言分别设置字号（px）与字间距（em），留空则不覆盖主题默认值。

### 导入字体 (Import)
*   **Web 字体**：粘贴包含 `@font-face` 或 `@import` 的 CSS URL，点击导入。
*   **本地文件**：点击「浏览...」选择电脑上的字体文件，插件会自动识别并导入。

## ⚠️ 注意事项

*   **性能**：虽然插件使用了 IndexedDB 优化存储，但导入过大（如 >20MB）的中文字体文件可能会导致初次加载稍慢。建议使用裁剪过的 Web 字体或 WOFF2 格式。
*   **冲突**：如果你的主题 (Theme) 强制使用了 `!important` 覆盖字体，本插件的设置可能会被覆盖。插件已尽可能使用高优先级 CSS，但在极少数情况下可能需要手动调整主题 CSS。


